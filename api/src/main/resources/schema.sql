-- DROP existing tables for clean local runs
DROP TABLE IF EXISTS LOAN;
DROP TABLE IF EXISTS BOOK;
DROP TABLE IF EXISTS AUTHOR;
DROP TABLE IF EXISTS USERS;

-- ==========================
--  TABLE: USERS
-- ==========================
CREATE TABLE USERS
(
    U_ID               BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    U_FIRST_NAME       VARCHAR(100) NOT NULL,
    U_LAST_NAME        VARCHAR(100) NOT NULL,
    U_EMAIL            VARCHAR(150) NOT NULL UNIQUE,
    U_BIRTH_DATE       DATE,
    U_INSCRIPTION_DATE DATE
);

-- ==========================
--  TABLE: AUTHOR
-- ==========================
CREATE TABLE AUTHOR
(
    AU_ID         BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    AU_FIRST_NAME VARCHAR(100) NOT NULL,
    AU_LAST_NAME  VARCHAR(100) NOT NULL
);

-- ==========================
--  TABLE: BOOK
-- ==========================
CREATE TABLE BOOK
(
    BK_ID               BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BK_TITLE            VARCHAR(200) NOT NULL,
    BK_GENRE            VARCHAR(50)  NOT NULL,
    BK_PUBLICATION_DATE DATE,
    BK_AUTHOR_ID        BIGINT       NOT NULL,
    CONSTRAINT FK_BOOK_AUTHOR FOREIGN KEY (BK_AUTHOR_ID) REFERENCES AUTHOR (AU_ID)
);

-- ==========================
--  TABLE: LOAN
-- ==========================
CREATE TABLE LOAN
(
    LO_ID          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    LO_USER_ID     BIGINT NOT NULL,
    LO_BOOK_ID     BIGINT NOT NULL,
    LO_LOAN_DATE   DATE   NOT NULL,
    LO_RETURN_DATE DATE,
    CONSTRAINT FK_LOAN_USER FOREIGN KEY (LO_USER_ID) REFERENCES USERS (U_ID),
    CONSTRAINT FK_LOAN_BOOK FOREIGN KEY (LO_BOOK_ID) REFERENCES BOOK (BK_ID)
);
